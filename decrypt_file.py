'''This works only in python2 version'''
import sys
import ast
import os

def decrypt(file, key, header_size):
	key_file = open(key,"rb")
	decrypt_key = ast.literal_eval(key_file.read())
	encrypted_file = open(file, 'rb')
	encrypted_data = encrypted_file.read()
	file_len = len(encrypted_data)
	decrypt_data = ''

	if file_len >header_size:
		for i in range(0,header_size):
			decrypt_data = decrypt_data + chr(ord(encrypted_data[i])^decrypt_key[i%len(decrypt_key)])
		decrypt_data = decrypt_data + encrypted_data[header_size:]
	else:
		for i in range(0,file_len):
			decrypt_data = decrypt_data + chr(ord(encrypted_data[i])^decrypt_key[i%len(decrypt_key)])

	open(file[:-8], 'wb').write(decrypt_data)
	encrypted_file.close()
	print "Decryption done successfully\n"


if len(sys.argv) == 4:
	for sub_dir, directory, files in os.walk(str(sys.argv[1])):
		for file in files:
			if file.endswith('.crypted'):
				path = os.path.join(sub_dir, file)
				decrypt(path, sys.argv[2], int(sys.argv[3]))
else:
	print "Usage: filename imgfolderpath keyfile headersize\n"





